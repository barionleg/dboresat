<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ACS Capstone 2018 Firmware Documentation: source/bldc.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ACS Capstone 2018 Firmware Documentation
   </div>
   <div id="projectbrief">Attitude Control System for OreSat</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b2f33c71d4aa5e7af42a1ca61ff5af1b.html">source</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">bldc.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="">bldc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="">sin_lut.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for bldc.c:</div>
<div class="dyncontent">
<div class="center"><img src="bldc_8c__incl.png" border="0" usemap="#source_2bldc_8c" alt=""/></div>
<map name="source_2bldc_8c" id="source_2bldc_8c">
<area shape="rect" id="node2" href="bldc_8h.html" title="bldc.h" alt="" coords="19,229,76,256"/>
<area shape="rect" id="node6" href="sin__lut_8h.html" title="sin_lut.h" alt="" coords="133,80,204,107"/>
<area shape="rect" id="node7" href="acs_8h.html" title="acs.h" alt="" coords="159,155,213,181"/>
<area shape="rect" id="node8" href="magnetorquer_8h.html" title="magnetorquer.h" alt="" coords="245,229,357,256"/>
</map>
</div>
</div>
<p><a href="">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab33213b168f1b881ddc092b70d45e130"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bldc_8c.html#ab33213b168f1b881ddc092b70d45e130">adcerrorcallback</a> (ADCDriver *adcp, adcerror_t err)</td></tr>
<tr class="memdesc:ab33213b168f1b881ddc092b70d45e130"><td class="mdescLeft">&#160;</td><td class="mdescRight">Currently not used.  <a href="#ab33213b168f1b881ddc092b70d45e130">More...</a><br /></td></tr>
<tr class="separator:ab33213b168f1b881ddc092b70d45e130"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1026b8fdcc494f55004ccb2ea66e8d57"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bldc_8c.html#a1026b8fdcc494f55004ccb2ea66e8d57">encoderToLut</a> (uint16_t position)</td></tr>
<tr class="memdesc:a1026b8fdcc494f55004ccb2ea66e8d57"><td class="mdescLeft">&#160;</td><td class="mdescRight">Translates encoder position into a useable LUT value.  <a href="#a1026b8fdcc494f55004ccb2ea66e8d57">More...</a><br /></td></tr>
<tr class="separator:a1026b8fdcc494f55004ccb2ea66e8d57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71b1fdf00528812ff996fdf4b96bd228"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bldc_8c.html#a71b1fdf00528812ff996fdf4b96bd228">THD_WORKING_AREA</a> (wa_spiThread, <a class="el" href="bldc_8h.html#a7449a369167c8d564211d1aca9ab870a">THREAD_SIZE</a>)</td></tr>
<tr class="memdesc:a71b1fdf00528812ff996fdf4b96bd228"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the SPI transaction, getting the position from the encoder.  <a href="#a71b1fdf00528812ff996fdf4b96bd228">More...</a><br /></td></tr>
<tr class="separator:a71b1fdf00528812ff996fdf4b96bd228"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a588ca931d31749e3f1434dd663be13e1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bldc_8c.html#a588ca931d31749e3f1434dd663be13e1">THD_FUNCTION</a> (spiThread, arg)</td></tr>
<tr class="memdesc:a588ca931d31749e3f1434dd663be13e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prototype for spi thread function.  <a href="#a588ca931d31749e3f1434dd663be13e1">More...</a><br /></td></tr>
<tr class="separator:a588ca931d31749e3f1434dd663be13e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab763f499f8303fd5d714ef316ca60021"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="bldc_8h.html#abd971c6edb54a543ddcc907c0e35b3ba">sinctrl_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bldc_8c.html#ab763f499f8303fd5d714ef316ca60021">scale</a> (<a class="el" href="bldc_8h.html#abd971c6edb54a543ddcc907c0e35b3ba">sinctrl_t</a> duty_cycle)</td></tr>
<tr class="memdesc:ab763f499f8303fd5d714ef316ca60021"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scales the duty ccycle value from LUT 0 - 100%.  <a href="#ab763f499f8303fd5d714ef316ca60021">More...</a><br /></td></tr>
<tr class="separator:ab763f499f8303fd5d714ef316ca60021"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a423ad9e13d0f4776ad590240cdaa658c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bldc_8c.html#a423ad9e13d0f4776ad590240cdaa658c">pwmpcb</a> (PWMDriver *pwmp)</td></tr>
<tr class="memdesc:a423ad9e13d0f4776ad590240cdaa658c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Periodic callback of the PWM driver.  <a href="#a423ad9e13d0f4776ad590240cdaa658c">More...</a><br /></td></tr>
<tr class="separator:a423ad9e13d0f4776ad590240cdaa658c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1ea68ddc405de21a77e183d2454109f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bldc_8c.html#ad1ea68ddc405de21a77e183d2454109f">bldcInit</a> (<a class="el" href="structbldc.html">bldc</a> *pbldc)</td></tr>
<tr class="memdesc:ad1ea68ddc405de21a77e183d2454109f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up initial values for the BLDC object.  <a href="#ad1ea68ddc405de21a77e183d2454109f">More...</a><br /></td></tr>
<tr class="separator:ad1ea68ddc405de21a77e183d2454109f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4a02bca771eea05efe11ddd9eda7676"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bldc_8c.html#ad4a02bca771eea05efe11ddd9eda7676">bldcStart</a> (<a class="el" href="structbldc.html">bldc</a> *pbldc)</td></tr>
<tr class="memdesc:ad4a02bca771eea05efe11ddd9eda7676"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enables the three PWM channels, starting to go through the LUT.  <a href="#ad4a02bca771eea05efe11ddd9eda7676">More...</a><br /></td></tr>
<tr class="separator:ad4a02bca771eea05efe11ddd9eda7676"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4b88584899a3c56753c48d02a49c1c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bldc_8c.html#af4b88584899a3c56753c48d02a49c1c7">bldcStop</a> (<a class="el" href="structbldc.html">bldc</a> *pbldc)</td></tr>
<tr class="memdesc:af4b88584899a3c56753c48d02a49c1c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops BLDC control.  <a href="#af4b88584899a3c56753c48d02a49c1c7">More...</a><br /></td></tr>
<tr class="separator:af4b88584899a3c56753c48d02a49c1c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf83faf52f9059334b5a7648670903ec"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bldc_8c.html#acf83faf52f9059334b5a7648670903ec">bldcSetDC</a> (uint8_t channel, uint16_t dc)</td></tr>
<tr class="memdesc:acf83faf52f9059334b5a7648670903ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Changes duty cycle for a given channel.  <a href="#acf83faf52f9059334b5a7648670903ec">More...</a><br /></td></tr>
<tr class="separator:acf83faf52f9059334b5a7648670903ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a680230ddbeb675f1529566ac2f62bb8c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bldc_8c.html#a680230ddbeb675f1529566ac2f62bb8c">bldcExit</a> (<a class="el" href="structbldc.html">bldc</a> *pbldc)</td></tr>
<tr class="memdesc:a680230ddbeb675f1529566ac2f62bb8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function prototype with no return type. Takes bldc type as paramater.  <a href="#a680230ddbeb675f1529566ac2f62bb8c">More...</a><br /></td></tr>
<tr class="separator:a680230ddbeb675f1529566ac2f62bb8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2577de6f8b2dd9febed0c4e74fee69c9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structbldc.html">bldc</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a></td></tr>
<tr class="separator:a2577de6f8b2dd9febed0c4e74fee69c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a549e94c7059274211bc3c24cc11ecf6c"><td class="memItemLeft" align="right" valign="top">static const ADCConversionGroup&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bldc_8c.html#a549e94c7059274211bc3c24cc11ecf6c">adcgrpcfg</a></td></tr>
<tr class="memdesc:a549e94c7059274211bc3c24cc11ecf6c"><td class="mdescLeft">&#160;</td><td class="mdescRight">ADC conversion group, used to configure the ADC driver Mode: Continuous, 1 sample of 1 channel, SW triggered. Channels: A0 Slowest sample rate possible, as putting it too high can lock other systems out.  <a href="#a549e94c7059274211bc3c24cc11ecf6c">More...</a><br /></td></tr>
<tr class="separator:a549e94c7059274211bc3c24cc11ecf6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4548e17380df832f4d1a2ec56ba8e95"><td class="memItemLeft" align="right" valign="top">static PWMConfig&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bldc_8c.html#aa4548e17380df832f4d1a2ec56ba8e95">pwmRWcfg</a></td></tr>
<tr class="memdesc:aa4548e17380df832f4d1a2ec56ba8e95"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pwm driver configuration structure.  <a href="#aa4548e17380df832f4d1a2ec56ba8e95">More...</a><br /></td></tr>
<tr class="separator:aa4548e17380df832f4d1a2ec56ba8e95"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ab33213b168f1b881ddc092b70d45e130"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab33213b168f1b881ddc092b70d45e130">&#9670;&nbsp;</a></span>adcerrorcallback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void adcerrorcallback </td>
          <td>(</td>
          <td class="paramtype">ADCDriver *&#160;</td>
          <td class="paramname"><em>adcp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">adcerror_t&#160;</td>
          <td class="paramname"><em>err</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Currently not used. </p>
<div class="fragment"><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;                                                              {</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    (void)adcp;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    (void)err;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a680230ddbeb675f1529566ac2f62bb8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a680230ddbeb675f1529566ac2f62bb8c">&#9670;&nbsp;</a></span>bldcExit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bldcExit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbldc.html">bldc</a> *&#160;</td>
          <td class="paramname"><em>pbldc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function prototype with no return type. Takes bldc type as paramater. </p>
<p>@ brief Tear down drivers in a sane way. </p>
<div class="fragment"><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                 {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">if</span>(pbldc-&gt;<a class="code" href="structbldc.html#a113e4d6a5b11bf8c10c4192c12598465">started</a>){</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <a class="code" href="bldc_8c.html#af4b88584899a3c56753c48d02a49c1c7">bldcStop</a>(pbldc);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  adcStopConversion(&amp;ADCD1);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  adcStop(&amp;ADCD1); </div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    chThdTerminate(<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a62a444da19a1963099b13f1cc4c62625">p_spi_thread</a>);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    chThdWait(<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a62a444da19a1963099b13f1cc4c62625">p_spi_thread</a>);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;}</div><div class="ttc" id="structbldc_html_a113e4d6a5b11bf8c10c4192c12598465"><div class="ttname"><a href="structbldc.html#a113e4d6a5b11bf8c10c4192c12598465">bldc::started</a></div><div class="ttdeci">int started</div><div class="ttdef"><b>Definition:</b> bldc.h:113</div></div>
<div class="ttc" id="bldc_8c_html_af4b88584899a3c56753c48d02a49c1c7"><div class="ttname"><a href="bldc_8c.html#af4b88584899a3c56753c48d02a49c1c7">bldcStop</a></div><div class="ttdeci">void bldcStop(bldc *pbldc)</div><div class="ttdoc">Stops BLDC control. </div><div class="ttdef"><b>Definition:</b> bldc.c:227</div></div>
<div class="ttc" id="structbldc_html_a62a444da19a1963099b13f1cc4c62625"><div class="ttname"><a href="structbldc.html#a62a444da19a1963099b13f1cc4c62625">bldc::p_spi_thread</a></div><div class="ttdeci">thread_t * p_spi_thread</div><div class="ttdef"><b>Definition:</b> bldc.h:111</div></div>
<div class="ttc" id="bldc_8c_html_a2577de6f8b2dd9febed0c4e74fee69c9"><div class="ttname"><a href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a></div><div class="ttdeci">bldc * motor</div><div class="ttdef"><b>Definition:</b> bldc.c:4</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad1ea68ddc405de21a77e183d2454109f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1ea68ddc405de21a77e183d2454109f">&#9670;&nbsp;</a></span>bldcInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bldcInit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbldc.html">bldc</a> *&#160;</td>
          <td class="paramname"><em>pbldc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets up initial values for the BLDC object. </p>
<p>Function prototype with no return type. Takes bldc type as paramater. </p>
<div class="fragment"><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                                 {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a> = pbldc;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a027cb3f86fa67b585334e8755e21cff1">steps</a> = <a class="code" href="bldc_8h.html#a1ca9f64427b2bc5b538fe2fa2501c639">STEPS</a>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac2cc6f385cc583e04c550d2f9cf00143">stretch</a> = <a class="code" href="bldc_8h.html#a795821fa9ac33b9837013c66cb263c79">STRETCH</a>;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#afa73906e3b0a89c76e380c5c08bb8216">stretch_count</a> = 0;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a3ee6d175bc43c2ab8bf4d0cc56d3bd30">scale</a> = <a class="code" href="bldc_8h.html#a0cbea62f1ce2043dd08108e65ed8de1d">SCALE</a>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a495cad51d278b0620330cf3d5c6d511e">skip</a> = <a class="code" href="bldc_8h.html#a688a4adbb87520a2b68681bd6bfb199e">SKIP</a>;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#abc5acda98ecccaa5232fffdf03b32594">sinctrl</a> = <a class="code" href="sin__lut_8h.html#a642e12af07e1a6ff6874e0ee87a05667">sinctrl360</a>;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac738285f1af7f40c9bc73ab38c4d583b">count</a> = 0;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a7e063b835df0a49bb1300c58fb17fedc">position</a> = 0;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac05eef7bdb4d5c9a6c82c54802a34ce2">phase_shift</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a027cb3f86fa67b585334e8755e21cff1">steps</a>/3;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a7fb423d23d4b0497174f71f69b5cdb06">u</a> = 0;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae3f6b5f35423c33a32eba8cccc4cd54c">v</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a7fb423d23d4b0497174f71f69b5cdb06">u</a> + <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac05eef7bdb4d5c9a6c82c54802a34ce2">phase_shift</a>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac9fdde02b2558abbbd996487e9614f3e">w</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae3f6b5f35423c33a32eba8cccc4cd54c">v</a> + <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac05eef7bdb4d5c9a6c82c54802a34ce2">phase_shift</a>;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#aefaa04059b3f854ff848f295f4386060">openLoop</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a113e4d6a5b11bf8c10c4192c12598465">started</a> = FALSE;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    </div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    adcStart(&amp;ADCD1, NULL); </div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  adcStartConversion(&amp;ADCD1, &amp;<a class="code" href="bldc_8c.html#a549e94c7059274211bc3c24cc11ecf6c">adcgrpcfg</a>, <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a271e4c4eb2638b5eb650fa0970c97a36">samples</a>, <a class="code" href="bldc_8h.html#af704141e047fc541db65054f72565858">ADC_GRP_BUF_DEPTH</a>);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    </div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a62a444da19a1963099b13f1cc4c62625">p_spi_thread</a>=chThdCreateStatic(</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        wa_spiThread,</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keyword">sizeof</span>(wa_spiThread),</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        NORMALPRIO,</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        spiThread,</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        NULL</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    );</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;}</div><div class="ttc" id="structbldc_html_a271e4c4eb2638b5eb650fa0970c97a36"><div class="ttname"><a href="structbldc.html#a271e4c4eb2638b5eb650fa0970c97a36">bldc::samples</a></div><div class="ttdeci">adcsample_t samples[ADC_GRP_NUM_CHANNELS *ADC_GRP_BUF_DEPTH]</div><div class="ttdef"><b>Definition:</b> bldc.h:112</div></div>
<div class="ttc" id="bldc_8h_html_a688a4adbb87520a2b68681bd6bfb199e"><div class="ttname"><a href="bldc_8h.html#a688a4adbb87520a2b68681bd6bfb199e">SKIP</a></div><div class="ttdeci">#define SKIP</div><div class="ttdef"><b>Definition:</b> bldc.h:42</div></div>
<div class="ttc" id="structbldc_html_ae3f6b5f35423c33a32eba8cccc4cd54c"><div class="ttname"><a href="structbldc.html#ae3f6b5f35423c33a32eba8cccc4cd54c">bldc::v</a></div><div class="ttdeci">sinctrl_t v</div><div class="ttdef"><b>Definition:</b> bldc.h:100</div></div>
<div class="ttc" id="structbldc_html_a113e4d6a5b11bf8c10c4192c12598465"><div class="ttname"><a href="structbldc.html#a113e4d6a5b11bf8c10c4192c12598465">bldc::started</a></div><div class="ttdeci">int started</div><div class="ttdef"><b>Definition:</b> bldc.h:113</div></div>
<div class="ttc" id="structbldc_html_ac738285f1af7f40c9bc73ab38c4d583b"><div class="ttname"><a href="structbldc.html#ac738285f1af7f40c9bc73ab38c4d583b">bldc::count</a></div><div class="ttdeci">uint16_t count</div><div class="ttdef"><b>Definition:</b> bldc.h:95</div></div>
<div class="ttc" id="structbldc_html_a3ee6d175bc43c2ab8bf4d0cc56d3bd30"><div class="ttname"><a href="structbldc.html#a3ee6d175bc43c2ab8bf4d0cc56d3bd30">bldc::scale</a></div><div class="ttdeci">uint16_t scale</div><div class="ttdoc">period counter </div><div class="ttdef"><b>Definition:</b> bldc.h:95</div></div>
<div class="ttc" id="structbldc_html_abc5acda98ecccaa5232fffdf03b32594"><div class="ttname"><a href="structbldc.html#abc5acda98ecccaa5232fffdf03b32594">bldc::sinctrl</a></div><div class="ttdeci">sinctrl_t const  * sinctrl</div><div class="ttdef"><b>Definition:</b> bldc.h:109</div></div>
<div class="ttc" id="structbldc_html_afa73906e3b0a89c76e380c5c08bb8216"><div class="ttname"><a href="structbldc.html#afa73906e3b0a89c76e380c5c08bb8216">bldc::stretch_count</a></div><div class="ttdeci">uint8_t stretch_count</div><div class="ttdef"><b>Definition:</b> bldc.h:105</div></div>
<div class="ttc" id="bldc_8h_html_a795821fa9ac33b9837013c66cb263c79"><div class="ttname"><a href="bldc_8h.html#a795821fa9ac33b9837013c66cb263c79">STRETCH</a></div><div class="ttdeci">#define STRETCH</div><div class="ttdef"><b>Definition:</b> bldc.h:41</div></div>
<div class="ttc" id="structbldc_html_ac9fdde02b2558abbbd996487e9614f3e"><div class="ttname"><a href="structbldc.html#ac9fdde02b2558abbbd996487e9614f3e">bldc::w</a></div><div class="ttdeci">sinctrl_t w</div><div class="ttdef"><b>Definition:</b> bldc.h:100</div></div>
<div class="ttc" id="structbldc_html_a7e063b835df0a49bb1300c58fb17fedc"><div class="ttname"><a href="structbldc.html#a7e063b835df0a49bb1300c58fb17fedc">bldc::position</a></div><div class="ttdeci">uint16_t position</div><div class="ttdef"><b>Definition:</b> bldc.h:107</div></div>
<div class="ttc" id="structbldc_html_ac05eef7bdb4d5c9a6c82c54802a34ce2"><div class="ttname"><a href="structbldc.html#ac05eef7bdb4d5c9a6c82c54802a34ce2">bldc::phase_shift</a></div><div class="ttdeci">sinctrl_t phase_shift</div><div class="ttdoc">signals </div><div class="ttdef"><b>Definition:</b> bldc.h:100</div></div>
<div class="ttc" id="sin__lut_8h_html_a642e12af07e1a6ff6874e0ee87a05667"><div class="ttname"><a href="sin__lut_8h.html#a642e12af07e1a6ff6874e0ee87a05667">sinctrl360</a></div><div class="ttdeci">const sinctrl_t sinctrl360[360]</div><div class="ttdef"><b>Definition:</b> sin_lut.h:6</div></div>
<div class="ttc" id="structbldc_html_a027cb3f86fa67b585334e8755e21cff1"><div class="ttname"><a href="structbldc.html#a027cb3f86fa67b585334e8755e21cff1">bldc::steps</a></div><div class="ttdeci">uint16_t steps</div><div class="ttdoc">scales the duty cycle </div><div class="ttdef"><b>Definition:</b> bldc.h:95</div></div>
<div class="ttc" id="structbldc_html_a62a444da19a1963099b13f1cc4c62625"><div class="ttname"><a href="structbldc.html#a62a444da19a1963099b13f1cc4c62625">bldc::p_spi_thread</a></div><div class="ttdeci">thread_t * p_spi_thread</div><div class="ttdef"><b>Definition:</b> bldc.h:111</div></div>
<div class="ttc" id="bldc_8h_html_a0cbea62f1ce2043dd08108e65ed8de1d"><div class="ttname"><a href="bldc_8h.html#a0cbea62f1ce2043dd08108e65ed8de1d">SCALE</a></div><div class="ttdeci">#define SCALE</div><div class="ttdef"><b>Definition:</b> bldc.h:39</div></div>
<div class="ttc" id="structbldc_html_ac2cc6f385cc583e04c550d2f9cf00143"><div class="ttname"><a href="structbldc.html#ac2cc6f385cc583e04c550d2f9cf00143">bldc::stretch</a></div><div class="ttdeci">uint16_t stretch</div><div class="ttdoc">number of steps in lut </div><div class="ttdef"><b>Definition:</b> bldc.h:95</div></div>
<div class="ttc" id="bldc_8h_html_a1ca9f64427b2bc5b538fe2fa2501c639"><div class="ttname"><a href="bldc_8h.html#a1ca9f64427b2bc5b538fe2fa2501c639">STEPS</a></div><div class="ttdeci">#define STEPS</div><div class="ttdef"><b>Definition:</b> bldc.h:40</div></div>
<div class="ttc" id="structbldc_html_a7fb423d23d4b0497174f71f69b5cdb06"><div class="ttname"><a href="structbldc.html#a7fb423d23d4b0497174f71f69b5cdb06">bldc::u</a></div><div class="ttdeci">sinctrl_t u</div><div class="ttdef"><b>Definition:</b> bldc.h:100</div></div>
<div class="ttc" id="bldc_8c_html_a2577de6f8b2dd9febed0c4e74fee69c9"><div class="ttname"><a href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a></div><div class="ttdeci">bldc * motor</div><div class="ttdef"><b>Definition:</b> bldc.c:4</div></div>
<div class="ttc" id="structbldc_html_a495cad51d278b0620330cf3d5c6d511e"><div class="ttname"><a href="structbldc.html#a495cad51d278b0620330cf3d5c6d511e">bldc::skip</a></div><div class="ttdeci">uint16_t skip</div><div class="ttdef"><b>Definition:</b> bldc.h:95</div></div>
<div class="ttc" id="bldc_8c_html_a549e94c7059274211bc3c24cc11ecf6c"><div class="ttname"><a href="bldc_8c.html#a549e94c7059274211bc3c24cc11ecf6c">adcgrpcfg</a></div><div class="ttdeci">static const ADCConversionGroup adcgrpcfg</div><div class="ttdoc">ADC conversion group, used to configure the ADC driver Mode: Continuous, 1 sample of 1 channel...</div><div class="ttdef"><b>Definition:</b> bldc.c:24</div></div>
<div class="ttc" id="structbldc_html_aefaa04059b3f854ff848f295f4386060"><div class="ttname"><a href="structbldc.html#aefaa04059b3f854ff848f295f4386060">bldc::openLoop</a></div><div class="ttdeci">bool openLoop</div><div class="ttdef"><b>Definition:</b> bldc.h:108</div></div>
<div class="ttc" id="bldc_8h_html_af704141e047fc541db65054f72565858"><div class="ttname"><a href="bldc_8h.html#af704141e047fc541db65054f72565858">ADC_GRP_BUF_DEPTH</a></div><div class="ttdeci">#define ADC_GRP_BUF_DEPTH</div><div class="ttdef"><b>Definition:</b> bldc.h:62</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acf83faf52f9059334b5a7648670903ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf83faf52f9059334b5a7648670903ec">&#9670;&nbsp;</a></span>bldcSetDC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bldcSetDC </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>dc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Changes duty cycle for a given channel. </p>
<p>Function prototype with no return type. Takes 8 bit unsigned integer and a 16 bit unsigned integer as argument. </p>
<div class="fragment"><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                                                  {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    pwmEnableChannelI(</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        &amp;PWMD1,</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        channel,</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        PWM_PERCENTAGE_TO_WIDTH(&amp;PWMD1,<a class="code" href="bldc_8c.html#ab763f499f8303fd5d714ef316ca60021">scale</a>(dc))</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    );</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;}</div><div class="ttc" id="bldc_8c_html_ab763f499f8303fd5d714ef316ca60021"><div class="ttname"><a href="bldc_8c.html#ab763f499f8303fd5d714ef316ca60021">scale</a></div><div class="ttdeci">static sinctrl_t scale(sinctrl_t duty_cycle)</div><div class="ttdoc">Scales the duty ccycle value from LUT 0 - 100%. </div><div class="ttdef"><b>Definition:</b> bldc.c:83</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad4a02bca771eea05efe11ddd9eda7676"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4a02bca771eea05efe11ddd9eda7676">&#9670;&nbsp;</a></span>bldcStart()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bldcStart </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbldc.html">bldc</a> *&#160;</td>
          <td class="paramname"><em>pbldc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enables the three PWM channels, starting to go through the LUT. </p>
<p>Function prototype with no return type. Takes bldc type as paramater. </p>
<div class="fragment"><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                                  {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span>(pbldc-&gt;<a class="code" href="structbldc.html#a113e4d6a5b11bf8c10c4192c12598465">started</a>){</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordflow">return</span>; </div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    pwmStart(&amp;PWMD1,&amp;<a class="code" href="bldc_8c.html#aa4548e17380df832f4d1a2ec56ba8e95">pwmRWcfg</a>);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  pwmEnablePeriodicNotification(&amp;PWMD1);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    </div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    pwmEnableChannel(&amp;PWMD1,<a class="code" href="bldc_8h.html#a036f95e2a5f4fc9bf16b9b94fbf01e4b">PWM_U</a>,PWM_PERCENTAGE_TO_WIDTH(&amp;PWMD1,<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a7fb423d23d4b0497174f71f69b5cdb06">u</a>));</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  pwmEnableChannel(&amp;PWMD1,<a class="code" href="bldc_8h.html#a8a0e777e8abf0f33b5554c8d5e6aeb6c">PWM_V</a>,PWM_PERCENTAGE_TO_WIDTH(&amp;PWMD1,<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae3f6b5f35423c33a32eba8cccc4cd54c">v</a>));</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  pwmEnableChannel(&amp;PWMD1,<a class="code" href="bldc_8h.html#a1f2740c922a098e7c6a3f5f126225180">PWM_W</a>,PWM_PERCENTAGE_TO_WIDTH(&amp;PWMD1,<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac9fdde02b2558abbbd996487e9614f3e">w</a>));</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    pbldc-&gt;<a class="code" href="structbldc.html#a113e4d6a5b11bf8c10c4192c12598465">started</a> = TRUE;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;}</div><div class="ttc" id="structbldc_html_ae3f6b5f35423c33a32eba8cccc4cd54c"><div class="ttname"><a href="structbldc.html#ae3f6b5f35423c33a32eba8cccc4cd54c">bldc::v</a></div><div class="ttdeci">sinctrl_t v</div><div class="ttdef"><b>Definition:</b> bldc.h:100</div></div>
<div class="ttc" id="bldc_8c_html_aa4548e17380df832f4d1a2ec56ba8e95"><div class="ttname"><a href="bldc_8c.html#aa4548e17380df832f4d1a2ec56ba8e95">pwmRWcfg</a></div><div class="ttdeci">static PWMConfig pwmRWcfg</div><div class="ttdoc">Pwm driver configuration structure. </div><div class="ttdef"><b>Definition:</b> bldc.c:158</div></div>
<div class="ttc" id="structbldc_html_a113e4d6a5b11bf8c10c4192c12598465"><div class="ttname"><a href="structbldc.html#a113e4d6a5b11bf8c10c4192c12598465">bldc::started</a></div><div class="ttdeci">int started</div><div class="ttdef"><b>Definition:</b> bldc.h:113</div></div>
<div class="ttc" id="bldc_8h_html_a036f95e2a5f4fc9bf16b9b94fbf01e4b"><div class="ttname"><a href="bldc_8h.html#a036f95e2a5f4fc9bf16b9b94fbf01e4b">PWM_U</a></div><div class="ttdeci">#define PWM_U</div><div class="ttdoc">PWM signals. </div><div class="ttdef"><b>Definition:</b> bldc.h:57</div></div>
<div class="ttc" id="structbldc_html_ac9fdde02b2558abbbd996487e9614f3e"><div class="ttname"><a href="structbldc.html#ac9fdde02b2558abbbd996487e9614f3e">bldc::w</a></div><div class="ttdeci">sinctrl_t w</div><div class="ttdef"><b>Definition:</b> bldc.h:100</div></div>
<div class="ttc" id="bldc_8h_html_a8a0e777e8abf0f33b5554c8d5e6aeb6c"><div class="ttname"><a href="bldc_8h.html#a8a0e777e8abf0f33b5554c8d5e6aeb6c">PWM_V</a></div><div class="ttdeci">#define PWM_V</div><div class="ttdef"><b>Definition:</b> bldc.h:58</div></div>
<div class="ttc" id="structbldc_html_a7fb423d23d4b0497174f71f69b5cdb06"><div class="ttname"><a href="structbldc.html#a7fb423d23d4b0497174f71f69b5cdb06">bldc::u</a></div><div class="ttdeci">sinctrl_t u</div><div class="ttdef"><b>Definition:</b> bldc.h:100</div></div>
<div class="ttc" id="bldc_8c_html_a2577de6f8b2dd9febed0c4e74fee69c9"><div class="ttname"><a href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a></div><div class="ttdeci">bldc * motor</div><div class="ttdef"><b>Definition:</b> bldc.c:4</div></div>
<div class="ttc" id="bldc_8h_html_a1f2740c922a098e7c6a3f5f126225180"><div class="ttname"><a href="bldc_8h.html#a1f2740c922a098e7c6a3f5f126225180">PWM_W</a></div><div class="ttdeci">#define PWM_W</div><div class="ttdef"><b>Definition:</b> bldc.h:59</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af4b88584899a3c56753c48d02a49c1c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4b88584899a3c56753c48d02a49c1c7">&#9670;&nbsp;</a></span>bldcStop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bldcStop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbldc.html">bldc</a> *&#160;</td>
          <td class="paramname"><em>pbldc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stops BLDC control. </p>
<p>Function prototype with no return type. Takes bldc type as paramater. </p>
<div class="fragment"><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                 {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">if</span>(!pbldc-&gt;<a class="code" href="structbldc.html#a113e4d6a5b11bf8c10c4192c12598465">started</a>){</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    pwmDisableChannel(&amp;PWMD1,<a class="code" href="bldc_8h.html#a036f95e2a5f4fc9bf16b9b94fbf01e4b">PWM_U</a>);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  pwmDisableChannel(&amp;PWMD1,<a class="code" href="bldc_8h.html#a8a0e777e8abf0f33b5554c8d5e6aeb6c">PWM_V</a>);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  pwmDisableChannel(&amp;PWMD1,<a class="code" href="bldc_8h.html#a1f2740c922a098e7c6a3f5f126225180">PWM_W</a>);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  pwmDisablePeriodicNotification(&amp;PWMD1);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    pwmStop(&amp;PWMD1);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    pbldc-&gt;<a class="code" href="structbldc.html#a113e4d6a5b11bf8c10c4192c12598465">started</a> = FALSE;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div><div class="ttc" id="structbldc_html_a113e4d6a5b11bf8c10c4192c12598465"><div class="ttname"><a href="structbldc.html#a113e4d6a5b11bf8c10c4192c12598465">bldc::started</a></div><div class="ttdeci">int started</div><div class="ttdef"><b>Definition:</b> bldc.h:113</div></div>
<div class="ttc" id="bldc_8h_html_a036f95e2a5f4fc9bf16b9b94fbf01e4b"><div class="ttname"><a href="bldc_8h.html#a036f95e2a5f4fc9bf16b9b94fbf01e4b">PWM_U</a></div><div class="ttdeci">#define PWM_U</div><div class="ttdoc">PWM signals. </div><div class="ttdef"><b>Definition:</b> bldc.h:57</div></div>
<div class="ttc" id="bldc_8h_html_a8a0e777e8abf0f33b5554c8d5e6aeb6c"><div class="ttname"><a href="bldc_8h.html#a8a0e777e8abf0f33b5554c8d5e6aeb6c">PWM_V</a></div><div class="ttdeci">#define PWM_V</div><div class="ttdef"><b>Definition:</b> bldc.h:58</div></div>
<div class="ttc" id="bldc_8h_html_a1f2740c922a098e7c6a3f5f126225180"><div class="ttname"><a href="bldc_8h.html#a1f2740c922a098e7c6a3f5f126225180">PWM_W</a></div><div class="ttdeci">#define PWM_W</div><div class="ttdef"><b>Definition:</b> bldc.h:59</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1026b8fdcc494f55004ccb2ea66e8d57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1026b8fdcc494f55004ccb2ea66e8d57">&#9670;&nbsp;</a></span>encoderToLut()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t encoderToLut </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>position</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Translates encoder position into a useable LUT value. </p>
<p>Since it takes 6 passes through the LUT to get one physical revolution of the motor, we need a way to index a value of 0 - 2^14 into a value of 0 - 360, in 6 separate ranges </p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                                               {</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  uint16_t step = 0;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  uint8_t chunk = (position * <a class="code" href="bldc_8h.html#af29293a6413a226cd50569f3e35b08b5">CHUNK_AMOUNT</a>) / <a class="code" href="bldc_8h.html#a1f12cd2d377e62c56999d46dc6bb7cfc">ENCODER_MAX</a>;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  step = ((position - <a class="code" href="bldc_8h.html#afa556e56bdcf3ff1dd041b95c0c78054">chunk_low</a>[chunk]) * (<a class="code" href="bldc_8h.html#a1ca9f64427b2bc5b538fe2fa2501c639">STEPS</a>)) / <a class="code" href="bldc_8h.html#aea3cfda4f3a9f978ec759f206cf186fe">CHUNK_SIZE</a>;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">return</span> step;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div><div class="ttc" id="bldc_8h_html_afa556e56bdcf3ff1dd041b95c0c78054"><div class="ttname"><a href="bldc_8h.html#afa556e56bdcf3ff1dd041b95c0c78054">chunk_low</a></div><div class="ttdeci">static const uint16_t chunk_low[6]</div><div class="ttdoc">The low value used to break up the encoder value into regions. </div><div class="ttdef"><b>Definition:</b> bldc.h:123</div></div>
<div class="ttc" id="bldc_8h_html_aea3cfda4f3a9f978ec759f206cf186fe"><div class="ttname"><a href="bldc_8h.html#aea3cfda4f3a9f978ec759f206cf186fe">CHUNK_SIZE</a></div><div class="ttdeci">#define CHUNK_SIZE</div><div class="ttdoc">chunk size is the number </div><div class="ttdef"><b>Definition:</b> bldc.h:50</div></div>
<div class="ttc" id="bldc_8h_html_a1f12cd2d377e62c56999d46dc6bb7cfc"><div class="ttname"><a href="bldc_8h.html#a1f12cd2d377e62c56999d46dc6bb7cfc">ENCODER_MAX</a></div><div class="ttdeci">#define ENCODER_MAX</div><div class="ttdoc">encoder has 14 bits of precision </div><div class="ttdef"><b>Definition:</b> bldc.h:45</div></div>
<div class="ttc" id="bldc_8h_html_a1ca9f64427b2bc5b538fe2fa2501c639"><div class="ttname"><a href="bldc_8h.html#a1ca9f64427b2bc5b538fe2fa2501c639">STEPS</a></div><div class="ttdeci">#define STEPS</div><div class="ttdef"><b>Definition:</b> bldc.h:40</div></div>
<div class="ttc" id="bldc_8h_html_af29293a6413a226cd50569f3e35b08b5"><div class="ttname"><a href="bldc_8h.html#af29293a6413a226cd50569f3e35b08b5">CHUNK_AMOUNT</a></div><div class="ttdeci">#define CHUNK_AMOUNT</div><div class="ttdef"><b>Definition:</b> bldc.h:48</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a423ad9e13d0f4776ad590240cdaa658c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a423ad9e13d0f4776ad590240cdaa658c">&#9670;&nbsp;</a></span>pwmpcb()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void pwmpcb </td>
          <td>(</td>
          <td class="paramtype">PWMDriver *&#160;</td>
          <td class="paramname"><em>pwmp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Periodic callback of the PWM driver. </p>
<p>At the end of each period, we call this, and go to the next step in the LUT, which changes absed off of closed or open loop control. Holds the logic for stretching, skipping, and repeating, to modify the LUT values on the fly. </p>
<p>If open loop, ignore encoder feedback.</p>
<p>Calculate the difference between the current step in the LUT and the next step in the LUT, and break it up into the desired amount of steps in between the two </p>
<div class="fragment"><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                                    {</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  (void)pwmp;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  </div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#aefaa04059b3f854ff848f295f4386060">openLoop</a>){</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a7fb423d23d4b0497174f71f69b5cdb06">u</a> += <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a495cad51d278b0620330cf3d5c6d511e">skip</a>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae3f6b5f35423c33a32eba8cccc4cd54c">v</a> += <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a495cad51d278b0620330cf3d5c6d511e">skip</a>;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac9fdde02b2558abbbd996487e9614f3e">w</a> += <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a495cad51d278b0620330cf3d5c6d511e">skip</a>;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a7fb423d23d4b0497174f71f69b5cdb06">u</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a7fb423d23d4b0497174f71f69b5cdb06">u</a> % 360;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae3f6b5f35423c33a32eba8cccc4cd54c">v</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae3f6b5f35423c33a32eba8cccc4cd54c">v</a> % 360;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac9fdde02b2558abbbd996487e9614f3e">w</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac9fdde02b2558abbbd996487e9614f3e">w</a> % 360;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                </div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a6e61de284661dc70186e6b9ae54bd30e">current_sin_u</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#abc5acda98ecccaa5232fffdf03b32594">sinctrl</a>[<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a7fb423d23d4b0497174f71f69b5cdb06">u</a>];</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ab79d76dde2b625293ba0c97ae2875620">current_sin_v</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#abc5acda98ecccaa5232fffdf03b32594">sinctrl</a>[<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae3f6b5f35423c33a32eba8cccc4cd54c">v</a>];</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a31c4a00f3055ac46ab539af784012088">current_sin_w</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#abc5acda98ecccaa5232fffdf03b32594">sinctrl</a>[<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac9fdde02b2558abbbd996487e9614f3e">w</a>];</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#afa73906e3b0a89c76e380c5c08bb8216">stretch_count</a> == 0){</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a7fb423d23d4b0497174f71f69b5cdb06">u</a> = <a class="code" href="bldc_8c.html#a1026b8fdcc494f55004ccb2ea66e8d57">encoderToLut</a>(<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a7e063b835df0a49bb1300c58fb17fedc">position</a>);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae3f6b5f35423c33a32eba8cccc4cd54c">v</a> = (<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a7fb423d23d4b0497174f71f69b5cdb06">u</a> + <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac05eef7bdb4d5c9a6c82c54802a34ce2">phase_shift</a>) % 360;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac9fdde02b2558abbbd996487e9614f3e">w</a> = (<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae3f6b5f35423c33a32eba8cccc4cd54c">v</a> + <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac05eef7bdb4d5c9a6c82c54802a34ce2">phase_shift</a>) % 360;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a6e61de284661dc70186e6b9ae54bd30e">current_sin_u</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#abc5acda98ecccaa5232fffdf03b32594">sinctrl</a>[<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a7fb423d23d4b0497174f71f69b5cdb06">u</a>];</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ab79d76dde2b625293ba0c97ae2875620">current_sin_v</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#abc5acda98ecccaa5232fffdf03b32594">sinctrl</a>[<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae3f6b5f35423c33a32eba8cccc4cd54c">v</a>];</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a31c4a00f3055ac46ab539af784012088">current_sin_w</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#abc5acda98ecccaa5232fffdf03b32594">sinctrl</a>[<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac9fdde02b2558abbbd996487e9614f3e">w</a>];</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac54819fc029aada61962d06bf9bcaa08">next_sin_u</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#abc5acda98ecccaa5232fffdf03b32594">sinctrl</a>[<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a7fb423d23d4b0497174f71f69b5cdb06">u</a>+1];</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a0ba215d9653352c04468e8053f09e72e">next_sin_v</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#abc5acda98ecccaa5232fffdf03b32594">sinctrl</a>[<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae3f6b5f35423c33a32eba8cccc4cd54c">v</a>+1];</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a0dce8432f802a19e638e150f036b537a">next_sin_w</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#abc5acda98ecccaa5232fffdf03b32594">sinctrl</a>[<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac9fdde02b2558abbbd996487e9614f3e">w</a>+1];</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae751f8d99ab7ac61de7fb9843f23ecc0">sin_diff</a> = (<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a6e61de284661dc70186e6b9ae54bd30e">current_sin_u</a> &gt; <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac54819fc029aada61962d06bf9bcaa08">next_sin_u</a>)?</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                                                (<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a6e61de284661dc70186e6b9ae54bd30e">current_sin_u</a> - <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac54819fc029aada61962d06bf9bcaa08">next_sin_u</a>) : </div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                                                (<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac54819fc029aada61962d06bf9bcaa08">next_sin_u</a> - <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a6e61de284661dc70186e6b9ae54bd30e">current_sin_u</a>);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae751f8d99ab7ac61de7fb9843f23ecc0">sin_diff</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae751f8d99ab7ac61de7fb9843f23ecc0">sin_diff</a> / <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac2cc6f385cc583e04c550d2f9cf00143">stretch</a>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#afa73906e3b0a89c76e380c5c08bb8216">stretch_count</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ac2cc6f385cc583e04c550d2f9cf00143">stretch</a>;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a6e61de284661dc70186e6b9ae54bd30e">current_sin_u</a> += <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae751f8d99ab7ac61de7fb9843f23ecc0">sin_diff</a>;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ab79d76dde2b625293ba0c97ae2875620">current_sin_v</a> += <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae751f8d99ab7ac61de7fb9843f23ecc0">sin_diff</a>;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a31c4a00f3055ac46ab539af784012088">current_sin_w</a> += <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ae751f8d99ab7ac61de7fb9843f23ecc0">sin_diff</a>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#afa73906e3b0a89c76e380c5c08bb8216">stretch_count</a> = <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#afa73906e3b0a89c76e380c5c08bb8216">stretch_count</a> - 1;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <a class="code" href="bldc_8c.html#acf83faf52f9059334b5a7648670903ec">bldcSetDC</a>(<a class="code" href="bldc_8h.html#a036f95e2a5f4fc9bf16b9b94fbf01e4b">PWM_U</a>,<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a6e61de284661dc70186e6b9ae54bd30e">current_sin_u</a>);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="bldc_8c.html#acf83faf52f9059334b5a7648670903ec">bldcSetDC</a>(<a class="code" href="bldc_8h.html#a8a0e777e8abf0f33b5554c8d5e6aeb6c">PWM_V</a>,<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#ab79d76dde2b625293ba0c97ae2875620">current_sin_v</a>);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="bldc_8c.html#acf83faf52f9059334b5a7648670903ec">bldcSetDC</a>(<a class="code" href="bldc_8h.html#a1f2740c922a098e7c6a3f5f126225180">PWM_W</a>,<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a31c4a00f3055ac46ab539af784012088">current_sin_w</a>);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;}</div><div class="ttc" id="structbldc_html_a6e61de284661dc70186e6b9ae54bd30e"><div class="ttname"><a href="structbldc.html#a6e61de284661dc70186e6b9ae54bd30e">bldc::current_sin_u</a></div><div class="ttdeci">uint16_t current_sin_u</div><div class="ttdoc">should be by 120 degrees </div><div class="ttdef"><b>Definition:</b> bldc.h:102</div></div>
<div class="ttc" id="structbldc_html_ab79d76dde2b625293ba0c97ae2875620"><div class="ttname"><a href="structbldc.html#ab79d76dde2b625293ba0c97ae2875620">bldc::current_sin_v</a></div><div class="ttdeci">uint16_t current_sin_v</div><div class="ttdef"><b>Definition:</b> bldc.h:102</div></div>
<div class="ttc" id="structbldc_html_ae3f6b5f35423c33a32eba8cccc4cd54c"><div class="ttname"><a href="structbldc.html#ae3f6b5f35423c33a32eba8cccc4cd54c">bldc::v</a></div><div class="ttdeci">sinctrl_t v</div><div class="ttdef"><b>Definition:</b> bldc.h:100</div></div>
<div class="ttc" id="bldc_8h_html_a036f95e2a5f4fc9bf16b9b94fbf01e4b"><div class="ttname"><a href="bldc_8h.html#a036f95e2a5f4fc9bf16b9b94fbf01e4b">PWM_U</a></div><div class="ttdeci">#define PWM_U</div><div class="ttdoc">PWM signals. </div><div class="ttdef"><b>Definition:</b> bldc.h:57</div></div>
<div class="ttc" id="structbldc_html_a31c4a00f3055ac46ab539af784012088"><div class="ttname"><a href="structbldc.html#a31c4a00f3055ac46ab539af784012088">bldc::current_sin_w</a></div><div class="ttdeci">uint16_t current_sin_w</div><div class="ttdef"><b>Definition:</b> bldc.h:102</div></div>
<div class="ttc" id="structbldc_html_a0dce8432f802a19e638e150f036b537a"><div class="ttname"><a href="structbldc.html#a0dce8432f802a19e638e150f036b537a">bldc::next_sin_w</a></div><div class="ttdeci">uint16_t next_sin_w</div><div class="ttdef"><b>Definition:</b> bldc.h:102</div></div>
<div class="ttc" id="structbldc_html_a0ba215d9653352c04468e8053f09e72e"><div class="ttname"><a href="structbldc.html#a0ba215d9653352c04468e8053f09e72e">bldc::next_sin_v</a></div><div class="ttdeci">uint16_t next_sin_v</div><div class="ttdef"><b>Definition:</b> bldc.h:102</div></div>
<div class="ttc" id="structbldc_html_abc5acda98ecccaa5232fffdf03b32594"><div class="ttname"><a href="structbldc.html#abc5acda98ecccaa5232fffdf03b32594">bldc::sinctrl</a></div><div class="ttdeci">sinctrl_t const  * sinctrl</div><div class="ttdef"><b>Definition:</b> bldc.h:109</div></div>
<div class="ttc" id="structbldc_html_afa73906e3b0a89c76e380c5c08bb8216"><div class="ttname"><a href="structbldc.html#afa73906e3b0a89c76e380c5c08bb8216">bldc::stretch_count</a></div><div class="ttdeci">uint8_t stretch_count</div><div class="ttdef"><b>Definition:</b> bldc.h:105</div></div>
<div class="ttc" id="bldc_8c_html_acf83faf52f9059334b5a7648670903ec"><div class="ttname"><a href="bldc_8c.html#acf83faf52f9059334b5a7648670903ec">bldcSetDC</a></div><div class="ttdeci">void bldcSetDC(uint8_t channel, uint16_t dc)</div><div class="ttdoc">Changes duty cycle for a given channel. </div><div class="ttdef"><b>Definition:</b> bldc.c:243</div></div>
<div class="ttc" id="structbldc_html_ac9fdde02b2558abbbd996487e9614f3e"><div class="ttname"><a href="structbldc.html#ac9fdde02b2558abbbd996487e9614f3e">bldc::w</a></div><div class="ttdeci">sinctrl_t w</div><div class="ttdef"><b>Definition:</b> bldc.h:100</div></div>
<div class="ttc" id="structbldc_html_a7e063b835df0a49bb1300c58fb17fedc"><div class="ttname"><a href="structbldc.html#a7e063b835df0a49bb1300c58fb17fedc">bldc::position</a></div><div class="ttdeci">uint16_t position</div><div class="ttdef"><b>Definition:</b> bldc.h:107</div></div>
<div class="ttc" id="bldc_8h_html_a8a0e777e8abf0f33b5554c8d5e6aeb6c"><div class="ttname"><a href="bldc_8h.html#a8a0e777e8abf0f33b5554c8d5e6aeb6c">PWM_V</a></div><div class="ttdeci">#define PWM_V</div><div class="ttdef"><b>Definition:</b> bldc.h:58</div></div>
<div class="ttc" id="structbldc_html_ac05eef7bdb4d5c9a6c82c54802a34ce2"><div class="ttname"><a href="structbldc.html#ac05eef7bdb4d5c9a6c82c54802a34ce2">bldc::phase_shift</a></div><div class="ttdeci">sinctrl_t phase_shift</div><div class="ttdoc">signals </div><div class="ttdef"><b>Definition:</b> bldc.h:100</div></div>
<div class="ttc" id="bldc_8c_html_a1026b8fdcc494f55004ccb2ea66e8d57"><div class="ttname"><a href="bldc_8c.html#a1026b8fdcc494f55004ccb2ea66e8d57">encoderToLut</a></div><div class="ttdeci">static uint16_t encoderToLut(uint16_t position)</div><div class="ttdoc">Translates encoder position into a useable LUT value. </div><div class="ttdef"><b>Definition:</b> bldc.c:43</div></div>
<div class="ttc" id="structbldc_html_ac2cc6f385cc583e04c550d2f9cf00143"><div class="ttname"><a href="structbldc.html#ac2cc6f385cc583e04c550d2f9cf00143">bldc::stretch</a></div><div class="ttdeci">uint16_t stretch</div><div class="ttdoc">number of steps in lut </div><div class="ttdef"><b>Definition:</b> bldc.h:95</div></div>
<div class="ttc" id="structbldc_html_a7fb423d23d4b0497174f71f69b5cdb06"><div class="ttname"><a href="structbldc.html#a7fb423d23d4b0497174f71f69b5cdb06">bldc::u</a></div><div class="ttdeci">sinctrl_t u</div><div class="ttdef"><b>Definition:</b> bldc.h:100</div></div>
<div class="ttc" id="structbldc_html_ac54819fc029aada61962d06bf9bcaa08"><div class="ttname"><a href="structbldc.html#ac54819fc029aada61962d06bf9bcaa08">bldc::next_sin_u</a></div><div class="ttdeci">uint16_t next_sin_u</div><div class="ttdef"><b>Definition:</b> bldc.h:102</div></div>
<div class="ttc" id="bldc_8c_html_a2577de6f8b2dd9febed0c4e74fee69c9"><div class="ttname"><a href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a></div><div class="ttdeci">bldc * motor</div><div class="ttdef"><b>Definition:</b> bldc.c:4</div></div>
<div class="ttc" id="structbldc_html_a495cad51d278b0620330cf3d5c6d511e"><div class="ttname"><a href="structbldc.html#a495cad51d278b0620330cf3d5c6d511e">bldc::skip</a></div><div class="ttdeci">uint16_t skip</div><div class="ttdef"><b>Definition:</b> bldc.h:95</div></div>
<div class="ttc" id="bldc_8h_html_a1f2740c922a098e7c6a3f5f126225180"><div class="ttname"><a href="bldc_8h.html#a1f2740c922a098e7c6a3f5f126225180">PWM_W</a></div><div class="ttdeci">#define PWM_W</div><div class="ttdef"><b>Definition:</b> bldc.h:59</div></div>
<div class="ttc" id="structbldc_html_ae751f8d99ab7ac61de7fb9843f23ecc0"><div class="ttname"><a href="structbldc.html#ae751f8d99ab7ac61de7fb9843f23ecc0">bldc::sin_diff</a></div><div class="ttdeci">uint8_t sin_diff</div><div class="ttdef"><b>Definition:</b> bldc.h:106</div></div>
<div class="ttc" id="structbldc_html_aefaa04059b3f854ff848f295f4386060"><div class="ttname"><a href="structbldc.html#aefaa04059b3f854ff848f295f4386060">bldc::openLoop</a></div><div class="ttdeci">bool openLoop</div><div class="ttdef"><b>Definition:</b> bldc.h:108</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab763f499f8303fd5d714ef316ca60021"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab763f499f8303fd5d714ef316ca60021">&#9670;&nbsp;</a></span>scale()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="bldc_8h.html#abd971c6edb54a543ddcc907c0e35b3ba">sinctrl_t</a> scale </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="bldc_8h.html#abd971c6edb54a543ddcc907c0e35b3ba">sinctrl_t</a>&#160;</td>
          <td class="paramname"><em>duty_cycle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Scales the duty ccycle value from LUT 0 - 100%. </p>
<div class="fragment"><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                                            {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">return</span> ((duty_cycle*<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a3ee6d175bc43c2ab8bf4d0cc56d3bd30">scale</a>)/100) + ((10000*(<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a3ee6d175bc43c2ab8bf4d0cc56d3bd30">scale</a>/2))/100);    </div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;}</div><div class="ttc" id="structbldc_html_a3ee6d175bc43c2ab8bf4d0cc56d3bd30"><div class="ttname"><a href="structbldc.html#a3ee6d175bc43c2ab8bf4d0cc56d3bd30">bldc::scale</a></div><div class="ttdeci">uint16_t scale</div><div class="ttdoc">period counter </div><div class="ttdef"><b>Definition:</b> bldc.h:95</div></div>
<div class="ttc" id="bldc_8c_html_a2577de6f8b2dd9febed0c4e74fee69c9"><div class="ttname"><a href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a></div><div class="ttdeci">bldc * motor</div><div class="ttdef"><b>Definition:</b> bldc.c:4</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a588ca931d31749e3f1434dd663be13e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a588ca931d31749e3f1434dd663be13e1">&#9670;&nbsp;</a></span>THD_FUNCTION()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">THD_FUNCTION </td>
          <td>(</td>
          <td class="paramtype">spiThread&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">arg&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prototype for spi thread function. </p>
<div class="fragment"><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                           {</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  (void)arg;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    chRegSetThreadName(<span class="stringliteral">&quot;spiThread&quot;</span>);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  spiStart(&amp;SPID1,&amp;<a class="code" href="bldc_8h.html#ad7e91275a3910c1ad03aa008b2c3e880">spicfg</a>);             <span class="comment">// Start driver.</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  spiAcquireBus(&amp;SPID1);                <span class="comment">// Gain ownership of bus.</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordflow">while</span> (!chThdShouldTerminateX()) {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#af7d20a7e9c4ee7ae755e03c35c7d2784">spi_rxbuf</a>[0] = 0;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        spiSelect(&amp;SPID1);                  <span class="comment">// Select slave.</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordflow">while</span>(SPID1.state != SPI_READY) {}   </div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        spiReceive(&amp;SPID1,1,<a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#af7d20a7e9c4ee7ae755e03c35c7d2784">spi_rxbuf</a>); <span class="comment">// Receive 1 frame (16 bits).</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        spiUnselect(&amp;SPID1);                <span class="comment">// Unselect slave.</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#a7e063b835df0a49bb1300c58fb17fedc">position</a> = 0x3FFF &amp; <a class="code" href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a>-&gt;<a class="code" href="structbldc.html#af7d20a7e9c4ee7ae755e03c35c7d2784">spi_rxbuf</a>[0];</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;     </div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  }</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    spiReleaseBus(&amp;SPID1);    <span class="comment">// Release ownership of bus.</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    spiStop(&amp;SPID1);          <span class="comment">// Stop driver.</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div><div class="ttc" id="structbldc_html_af7d20a7e9c4ee7ae755e03c35c7d2784"><div class="ttname"><a href="structbldc.html#af7d20a7e9c4ee7ae755e03c35c7d2784">bldc::spi_rxbuf</a></div><div class="ttdeci">uint16_t spi_rxbuf[2]</div><div class="ttdef"><b>Definition:</b> bldc.h:110</div></div>
<div class="ttc" id="structbldc_html_a7e063b835df0a49bb1300c58fb17fedc"><div class="ttname"><a href="structbldc.html#a7e063b835df0a49bb1300c58fb17fedc">bldc::position</a></div><div class="ttdeci">uint16_t position</div><div class="ttdef"><b>Definition:</b> bldc.h:107</div></div>
<div class="ttc" id="bldc_8h_html_ad7e91275a3910c1ad03aa008b2c3e880"><div class="ttname"><a href="bldc_8h.html#ad7e91275a3910c1ad03aa008b2c3e880">spicfg</a></div><div class="ttdeci">static const SPIConfig spicfg</div><div class="ttdoc">Control structure used to configure the SPI driver. </div><div class="ttdef"><b>Definition:</b> bldc.h:142</div></div>
<div class="ttc" id="bldc_8c_html_a2577de6f8b2dd9febed0c4e74fee69c9"><div class="ttname"><a href="bldc_8c.html#a2577de6f8b2dd9febed0c4e74fee69c9">motor</a></div><div class="ttdeci">bldc * motor</div><div class="ttdef"><b>Definition:</b> bldc.c:4</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a71b1fdf00528812ff996fdf4b96bd228"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71b1fdf00528812ff996fdf4b96bd228">&#9670;&nbsp;</a></span>THD_WORKING_AREA()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">THD_WORKING_AREA </td>
          <td>(</td>
          <td class="paramtype">wa_spiThread&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="bldc_8h.html#a7449a369167c8d564211d1aca9ab870a">THREAD_SIZE</a>&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles the SPI transaction, getting the position from the encoder. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a549e94c7059274211bc3c24cc11ecf6c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a549e94c7059274211bc3c24cc11ecf6c">&#9670;&nbsp;</a></span>adcgrpcfg</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const ADCConversionGroup adcgrpcfg</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">    TRUE,</div><div class="line">    <a class="code" href="bldc_8h.html#a9d0324f5b8c99f6ed7808eb0bf236fb4">ADC_GRP_NUM_CHANNELS</a>,</div><div class="line">    NULL,</div><div class="line">    <a class="code" href="bldc_8c.html#ab33213b168f1b881ddc092b70d45e130">adcerrorcallback</a>,</div><div class="line">    ADC_CFGR1_CONT | ADC_CFGR1_RES_12BIT,      </div><div class="line">    ADC_TR(0, 0),                              </div><div class="line">    ADC_SMPR_SMP_239P5,                        </div><div class="line">    ADC_CHSELR_CHSEL0                          </div><div class="line">}</div><div class="ttc" id="bldc_8h_html_a9d0324f5b8c99f6ed7808eb0bf236fb4"><div class="ttname"><a href="bldc_8h.html#a9d0324f5b8c99f6ed7808eb0bf236fb4">ADC_GRP_NUM_CHANNELS</a></div><div class="ttdeci">#define ADC_GRP_NUM_CHANNELS</div><div class="ttdef"><b>Definition:</b> bldc.h:61</div></div>
<div class="ttc" id="bldc_8c_html_ab33213b168f1b881ddc092b70d45e130"><div class="ttname"><a href="bldc_8c.html#ab33213b168f1b881ddc092b70d45e130">adcerrorcallback</a></div><div class="ttdeci">static void adcerrorcallback(ADCDriver *adcp, adcerror_t err)</div><div class="ttdoc">Currently not used. </div><div class="ttdef"><b>Definition:</b> bldc.c:11</div></div>
</div><!-- fragment -->
<p>ADC conversion group, used to configure the ADC driver Mode: Continuous, 1 sample of 1 channel, SW triggered. Channels: A0 Slowest sample rate possible, as putting it too high can lock other systems out. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000014">Todo:</a></b></dt><dd>: combine this with a timer to not spam interrupts so much? </dd></dl>

</div>
</div>
<a id="a2577de6f8b2dd9febed0c4e74fee69c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2577de6f8b2dd9febed0c4e74fee69c9">&#9670;&nbsp;</a></span>motor</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structbldc.html">bldc</a>* motor</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa4548e17380df832f4d1a2ec56ba8e95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4548e17380df832f4d1a2ec56ba8e95">&#9670;&nbsp;</a></span>pwmRWcfg</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PWMConfig pwmRWcfg</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">  <a class="code" href="bldc_8h.html#a625323d8ea39e2dc6951a84f893b6497">PWM_TIMER_FREQ</a>,   </div><div class="line">  <a class="code" href="bldc_8h.html#aacaca0988244bd3a888ca5befa89f44b">PWM_PERIOD</a>,   </div><div class="line">  <a class="code" href="bldc_8c.html#a423ad9e13d0f4776ad590240cdaa658c">pwmpcb</a>,</div><div class="line">  {</div><div class="line">   {PWM_OUTPUT_ACTIVE_HIGH|PWM_COMPLEMENTARY_OUTPUT_ACTIVE_HIGH, NULL},</div><div class="line">   {PWM_OUTPUT_ACTIVE_HIGH|PWM_COMPLEMENTARY_OUTPUT_ACTIVE_HIGH, NULL},</div><div class="line">   {PWM_OUTPUT_ACTIVE_HIGH|PWM_COMPLEMENTARY_OUTPUT_ACTIVE_HIGH, NULL},</div><div class="line">   {PWM_OUTPUT_DISABLED, NULL}</div><div class="line">  },</div><div class="line">  0,</div><div class="line">    0,</div><div class="line">  0</div><div class="line">}</div><div class="ttc" id="bldc_8h_html_a625323d8ea39e2dc6951a84f893b6497"><div class="ttname"><a href="bldc_8h.html#a625323d8ea39e2dc6951a84f893b6497">PWM_TIMER_FREQ</a></div><div class="ttdeci">#define PWM_TIMER_FREQ</div><div class="ttdef"><b>Definition:</b> bldc.h:52</div></div>
<div class="ttc" id="bldc_8h_html_aacaca0988244bd3a888ca5befa89f44b"><div class="ttname"><a href="bldc_8h.html#aacaca0988244bd3a888ca5befa89f44b">PWM_PERIOD</a></div><div class="ttdeci">#define PWM_PERIOD</div><div class="ttdef"><b>Definition:</b> bldc.h:54</div></div>
<div class="ttc" id="bldc_8c_html_a423ad9e13d0f4776ad590240cdaa658c"><div class="ttname"><a href="bldc_8c.html#a423ad9e13d0f4776ad590240cdaa658c">pwmpcb</a></div><div class="ttdeci">static void pwmpcb(PWMDriver *pwmp)</div><div class="ttdoc">Periodic callback of the PWM driver. </div><div class="ttdef"><b>Definition:</b> bldc.c:96</div></div>
</div><!-- fragment -->
<p>Pwm driver configuration structure. </p>
<p>PWM_TIMER_FREQ is our timer clock in Hz</p>
<p>PWM_PERIOD period in ticks</p>
<p>Configured with pwmpcb as the periodic callback PWM channels 0,1,2 are all active high, with a complementary output and no channel callback </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
